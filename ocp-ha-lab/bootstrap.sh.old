#!/bin/bash
#

# Pre-install
#
ansible-playbook pre_install.yml

# Pre-req
#
ansible-playbook -f 20 /usr/share/ansible/openshift-ansible/playbooks/prerequisites.yml

# manage_cgroup fix for cfme
#
ansible nodes -m command -a 'setsebool -P container_manage_cgroup on'

# Deploy Cluster
#
ansible-playbook -f 20 /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml

# Grab kube config
ansible masters[0] -b -m fetch -a "src=/root/.kube/config dest=/root/.kube/config flat=yes"

# Sleep 300
#
echo "Sleeping 300..."

# Add CFME provider
#
ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/openshift-management/add_container_provider.yml

# Verify whoami
oc whoami

# Get nodes
oc get nodes -o wide

# Group Sync
ansible-playbook --ask-vault-pass group_sync.yml
