- name: Create OCP4 Cluster
  hosts: localhost
  order: inventory
  vars_prompt:
    - name: sbid
      prompt: "sandbox id"
      private: no
    - name: multitenant
      prompt: "Use Multitenant plug-in (yes/no)"
      private: no
      default: no

  pre_tasks:
    - name: Check if cluster-guid-key.pub exists
      fail:
        msg: "Error: Please provide cluster-{{ guid }}-key.pub!"
      when: config.installer_ssh_key is none or config.installer_ssh_key == ""
    - name: Check if pull-secret.json exists
      fail:
        msg: "Error: Please provide pull-secret.json!"
      when: config.pull_secret is none or config.pull_secret == ""
    - name: Get installer version
      command: openshift-install version
      register: ocp_install_ver

  roles:
    - role: create-install-config
    - role: create-manifests
